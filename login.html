<!DOCTYPE html>
<html lang='pt-br'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='login.css'>
    <!-- <script src='app.js' defer></script> -->
    <title>Document</title>
</head>

<body>

    <form>
        <h3>Login</h3>
        <label for="username">Usuário:</label>
        <input type="text" name="username" id="username">

        <label for="password">Senha:</label>
        <input type="password" name="password" id="password">
        <label id="msgError">Login ou senha inválido.</label>
        <div class="remember">
            <input type="checkbox">
            <span>Lembrar login?</span>
        </div>
        <button type="submit" id="btnSubmit">Entrar</button>
    </form>
</body>



<script>
    localStorage.clear()

    const UrlBack = "https://teste-livid-tau.vercel.app"

    document.querySelectorAll('form')[0].addEventListener('submit', login)


    async function login(e) {
        e.preventDefault()
        const username = document.querySelectorAll('[name="username"]')[0].value
        const password = document.querySelectorAll('[name="password"]')[0].value

        const response = await fetch(`${UrlBack}/login`, {
            method: "POST",
            body: JSON.stringify({ username, password }),
            headers: { "Content-Type": "application/json" }
        })
        if (response.status === 400) {
            incorrectLogin()
        } else {
            const data = await response.json()
            localStorage.setItem("Token", data.token)
            window.location.href = "home.html"
        }
    }

    function incorrectLogin() {
        document.querySelector('#msgError').style.display = "block"
        document.querySelectorAll('[name="username"]')[0].style.border = "1px solid red"
        document.querySelectorAll('[name="password"]')[0].style.border = "1px solid red"
    }



</script>

</html>